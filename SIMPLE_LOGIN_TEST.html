<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Login Test - IT HelpDesk Portal</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #0080ff 50%, #4da6ff 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #0066cc;
            margin-bottom: 30px;
        }
        
        .test-button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s ease;
        }
        
        .test-button:hover {
            background: #0052a3;
        }
        
        .error-button {
            background: #e74c3c;
        }
        
        .error-button:hover {
            background: #c0392b;
        }
        
        .success-button {
            background: #27ae60;
        }
        
        .success-button:hover {
            background: #229954;
        }
        
        .log-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            text-align: left;
            margin-top: 20px;
        }
        
        .config-display {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #b3d9ff;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .config-display code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ”§ Simple Login Test</h1>
        
        <div class="config-display">
            <h3>ðŸ“‹ Configuration</h3>
            <p><strong>Application ID:</strong> <code>7a572b71-a735-4852-92af-65931deaa38d</code></p>
            <p><strong>Tenant ID:</strong> <code>80f3b31b-5dc9-4605-a654-5ad7e6e5417c</code></p>
            <p><strong>Current URL:</strong> <code id="current-url"></code></p>
            <p><strong>Redirect URI:</strong> <code id="redirect-uri"></code></p>
        </div>
        
        <div id="status-display"></div>
        
        <button class="test-button" onclick="testDirectOAuth()">Test Direct OAuth URL</button>
        <button class="test-button" onclick="testMSAL()">Test MSAL Login</button>
        <button class="test-button" onclick="testRedirect()">Test Redirect Login</button>
        <button class="error-button" onclick="clearLog()">Clear Log</button>
        
        <div id="log-output" class="log-output">Click a test button to see results...</div>
    </div>

    <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
    <script>
        // Configuration
        const config = {
            clientId: '7a572b71-a735-4852-92af-65931deaa38d',
            tenantId: '80f3b31b-5dc9-4605-a654-5ad7e6e5417c',
            redirectUri: window.location.origin + '/auth-callback.html',
            scopes: ['User.Read', 'GroupMember.Read.All', 'Group.Read.All']
        };
        
        let msalInstance = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('redirect-uri').textContent = config.redirectUri;
            log('Simple login test initialized');
            log('Current URL: ' + window.location.href);
            log('Redirect URI: ' + config.redirectUri);
        });
        
        // Logging function
        function log(message) {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.textContent += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // Status display
        function showStatus(message, type) {
            const statusDisplay = document.getElementById('status-display');
            statusDisplay.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // Clear log
        function clearLog() {
            document.getElementById('log-output').textContent = '';
            document.getElementById('status-display').innerHTML = '';
        }
        
        // Test direct OAuth URL
        function testDirectOAuth() {
            const oauthUrl = `https://login.microsoftonline.com/${config.tenantId}/oauth2/v2.0/authorize?` +
                `client_id=${config.clientId}&` +
                `response_type=code&` +
                `redirect_uri=${encodeURIComponent(config.redirectUri)}&` +
                `scope=${encodeURIComponent(config.scopes.join(' '))}&` +
                `response_mode=query&` +
                `state=test123`;
            
            log('Testing direct OAuth URL...');
            log('OAuth URL: ' + oauthUrl);
            showStatus('Opening OAuth URL in new tab...', 'info');
            
            // Open in new tab
            window.open(oauthUrl, '_blank');
        }
        
        // Test MSAL login
        async function testMSAL() {
            try {
                log('Testing MSAL login...');
                showStatus('Initializing MSAL...', 'info');
                
                const msalConfig = {
                    auth: {
                        clientId: config.clientId,
                        authority: `https://login.microsoftonline.com/${config.tenantId}`,
                        redirectUri: config.redirectUri
                    },
                    cache: {
                        cacheLocation: 'sessionStorage',
                        storeAuthStateInCookie: false
                    }
                };
                
                log('MSAL Config: ' + JSON.stringify(msalConfig, null, 2));
                
                msalInstance = new msal.PublicClientApplication(msalConfig);
                log('MSAL instance created successfully');
                
                // Handle redirect promise
                const response = await msalInstance.handleRedirectPromise();
                if (response) {
                    log('Redirect response received: ' + JSON.stringify(response, null, 2));
                    showStatus('Login successful via redirect!', 'success');
                } else {
                    log('No redirect response, trying popup login...');
                    
                    const loginRequest = {
                        scopes: config.scopes,
                        prompt: 'select_account'
                    };
                    
                    const popupResponse = await msalInstance.loginPopup(loginRequest);
                    log('Popup login successful: ' + JSON.stringify(popupResponse, null, 2));
                    showStatus('Login successful via popup!', 'success');
                }
                
            } catch (error) {
                log('MSAL login error: ' + error.message);
                log('Error details: ' + JSON.stringify(error, null, 2));
                showStatus('MSAL login failed: ' + error.message, 'error');
            }
        }
        
        // Test redirect login
        async function testRedirect() {
            try {
                log('Testing redirect login...');
                showStatus('Redirecting to Microsoft login...', 'info');
                
                const msalConfig = {
                    auth: {
                        clientId: config.clientId,
                        authority: `https://login.microsoftonline.com/${config.tenantId}`,
                        redirectUri: config.redirectUri
                    }
                };
                
                msalInstance = new msal.PublicClientApplication(msalConfig);
                
                const loginRequest = {
                    scopes: config.scopes,
                    prompt: 'select_account'
                };
                
                log('Starting redirect login...');
                await msalInstance.loginRedirect(loginRequest);
                
            } catch (error) {
                log('Redirect login error: ' + error.message);
                log('Error details: ' + JSON.stringify(error, null, 2));
                showStatus('Redirect login failed: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
